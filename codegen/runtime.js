#!/usr/bin/env node
/**
 * generated by the opake compiler
 */

"use strict";

var Obj = require('./Obj');
var System = require('./System');

var system = new System();

// create objects to model the OS environment

var stdout = system.createObject(function (body) {
    process.stdout.write("" + body);
});

var stderr = system.createObject(function (body) {
    process.stderr.write("" + body);
});

//var loader = system.createObject();

var exitCode = 0;

// this machine just stores the exit code
var out = system.createObject(function (body) {
});

var err = system.createObject(function (body) {
    exitCode = 1;
});

var io = {
    _out: stdout,
    _err: stderr
};

var main = function () {console.log("I think you ought to know I'm feeling very depressed.")};

// BEGIN GENERATED CODE

//<<CODE>>

// END GENERATED CODE

// create a machine for the compiled source
var root = system.createObject(main);

// send the launch message to the machine
// todo make this a real message
system.sendMessage(root, [process.argv, io, process.env], out, err);

// run the machine
system.run();

process.exit(exitCode);