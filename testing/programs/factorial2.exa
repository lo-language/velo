/*
 * iterative factorial calculator
 */

receive num;

if num < 0
    fail("I pity the fool!");

if num <= 1
    reply(1);

result = 1;

// could we auto-dect result is changing in here and hold off reply until this block is done?
// - reply waits on result
// - result is a promise because it is *modified* in an item closure
// - how would we know when to resolve the promise? implicit success callback I guess

// should closures not receive recur or reply? or any envelope addresses?
// they're handling responses, after all, which might have empty envelopes

// should have a compiler warning if you only attach -> to a sequence
2..n >>
    receive next;
    result *= next;
// this tears at my very soul
;

reply(result);
