/*
 recursive factorial calculator
 todo iterative version
*/

receive num;

if num < 0
    fail("I pity the fool!");

if num <= 1
    reply(1);

//result = 1
//
//2..num >>
//    receive x
//    result *= x

reply(num * recur(num - 1));

/*

have each ast node have a type - promise or ready

on the way up, if a statement contains promises, insert a new AST node to resolve them
has to happen at the statement level - the lowest statement that needs a promise resolved

a statement needs all its pieces to be ready, unless it's an isolated message stmt

manage needs by making blocks a tree rather than a list?

every send returns a promise in JS-land


x = foo();

if 4
    a = bar(x);
    b = bar(a);

if 4
    a = Q.when(x, fn(x_v) {bar(x_v);}
    b = Q.when(a, fn(a_v) {bar(a_v);}


///
to compile: explore down, render up

create context
add num to context symbol table as immediate
render select statement:

    fail = function () {};
    reply = function () {};
    recur = function () {};

    if ($_num < 0) {
        fail("I pity the fool!");
    }

    if ($_num <= 1) {
        reply(1);
    }

    recur(num - 1).then(function (val) {
        reply(num * val);
    });

    send();

render select statement
render reply statement

*/